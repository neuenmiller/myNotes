% core.tex - The foundational preamble for all my documents.
% Handles typography, page layout, colors, graphics, and bibliography.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{thamcore}[My Core LaTeX Preamble]

%----------------------------------------------------------------------------------------
%   DOCUMENT CLASS & ENCODING
%----------------------------------------------------------------------------------------
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

%----------------------------------------------------------------------------------------
%   PAGE LAYOUT & GEOMETRY
%----------------------------------------------------------------------------------------
\usepackage[
    a4paper,
    top=2.5cm,
    bottom=2.5cm,
    left=2.5cm,
    right=2.5cm,
    headheight=13.6pt
]{geometry}

%----------------------------------------------------------------------------------------
%   TYPOGRAPHY & FONTS
%----------------------------------------------------------------------------------------
\usepackage{lmodern}
\usepackage{textcase}
\usepackage{setspace}
\usepackage{csquotes}
\usepackage{babel}
\usepackage[
    activate={true,nocompatibility},
    final,
    tracking=true,
    kerning=true,
    spacing=true,
    factor=1100,
    stretch=10,
    shrink=10
]{microtype}
\microtypecontext{spacing=nonfrench}

%----------------------------------------------------------------------------------------
%   COLORS & HEADERS
%----------------------------------------------------------------------------------------
\usepackage[svgnames]{xcolor}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\fancyhead[C]{My Document Title}
\fancyfoot[C]{\thepage}
\let\cleardoublepage\clearpage

%----------------------------------------------------------------------------------------
%   TABLES, GRAPHICS, & LISTS
%----------------------------------------------------------------------------------------
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{enumitem}

%----------------------------------------------------------------------------------------
%   CORE MATH & SCIENCE PACKAGES
%%> MOVED UP: These are fundamental and must be loaded before packages that
%%> depend on them, like cleveref.
%----------------------------------------------------------------------------------------
\usepackage{amsmath}
\usepackage{amssymb}
%%> amsfonts is loaded by amssymb, so it's not explicitly needed here.

\usepackage{siunitx}
%%> FIXED: 'group-digits=false' is deprecated. Use 'none' instead.
\sisetup{group-digits=none}

%----------------------------------------------------------------------------------------
%   BIBLIOGRAPHY & CITATIONS
%%> MOVED UP: Load bibliography configuration before hyperlinks and references.
%----------------------------------------------------------------------------------------
\usepackage[
    backend=biber,
    style=numeric,
    sorting=none,
    citestyle=numeric-comp,
    language=english
]{biblatex}
% \addbibresource{references.bib} %%> Good practice to keep this in the main .tex file

%----------------------------------------------------------------------------------------
%   CROSS-REFERENCING & HYPERLINKS (CRITICAL ORDERING)
%%> REORDERED: This is the most important fix. The correct order is:
%%> 1. Math/theorem packages (amsmath)
%%> 2. cleveref
%%> 3. hyperref
%----------------------------------------------------------------------------------------
\usepackage{hyperref} % Should be loaded late, but BEFORE cleveref.
\hypersetup{
    colorlinks=true,
    linkcolor=NavyBlue,
    citecolor=DarkGreen,
    urlcolor=DarkBlue,
    pdftitle={My Document Title},
    pdfauthor={My Name},
    bookmarksopen=true,
    bookmarksnumbered=true
}

\usepackage[noabbrev]{cleveref} %%> CORRECTED: Must be loaded AFTER amsmath and hyperref.

%----------------------------------------------------------------------------------------
%   UTILITY & HELPER PACKAGES
%----------------------------------------------------------------------------------------
\usepackage{listings}
\lstset{
  basicstyle=\ttfamily\small,
  commentstyle=\color{DarkGreen},
  keywordstyle=\color{NavyBlue},
  stringstyle=\color{Firebrick},
  showstringspaces=false,
  breaklines=true,
  frame=single,
  numbers=left,
  numberstyle=\tiny\color{gray},
}

\usepackage{lipsum} % For placeholder text.